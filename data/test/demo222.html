<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

</body>
<script>
    /**
     * Created by Huang Wenbo on 2018/6/8.
     */
    ;(function () {
        var personId = null;
        $.ajaxSetup({cache: false});
        /*********************完成采集************************************/
        var collectionObj = {
            collInfoFlag: 0, // 基本信息
            collFpalmFlag: 0, // 指掌纹
            collFootFlag: 0,// 足迹
            collRelatedFlag: 0,// 关系人
            collBankcardFlag: 0,// 银行卡
            collSimFlag: 0,// sim卡
            collComputerFlag: 0 // 电脑信息
        };
        $(".finish-collect").on('click', function () {
            /*
             *  业务需求，必须保证左侧"必采项"
             *  才可以接下来去发送完成采集的接口
             */
            var flag = false;
            $(".must-collect:visible").each(function () {
                var $this = $(this);
                var tabItem = $this.parents('li').data('tab');
                var isCollectFlag = collectionObj[tabItem];
                if (!isCollectFlag) {
                    layer.msg('请保证所有的必采项目都采集完成并且保存成功', {
                        icon: 1,
                        time: 3000 //2秒关闭（如果不配置，默认是3秒）
                    });
                    flag = true;
                    return false;
                }
            });
            // 满足条件说明所有的必采集项目都已经采集完毕并保存成功
            if (!flag) { // 发送完成采集的http请求
                $.getJSON("/htmisWeb/personCollect/collectionCompleted.do", {personId: personId}, function (result) {
                    if (result.message && result.message === 'success') {
                        window.location.href = 'http://localhost:8080/htmisWeb/html/collection/result/index.html?personId=' + personId;
                    }
                });
            }
        });
        /*********全国请求服务功能***********************************************/
        var allCountryService = {
            init: function () {
                this.httpUrlObj = {
                    qgrk: '/htmisWeb/qq/qgrk.do', // 全国人口 url
                    qgwffz: '/htmisWeb/qq/qgwffz.do', // 违法犯罪 url
                    qgxfd: '/htmisWeb/qq/qgxfd.do', // 吸毒人员 url
                    qgzt: '/htmisWeb/qq/qgzt.do' // 在逃人员url
                };
                // 1.初始化请求全国人口信息 初始化请求违法犯罪信息
                // 2.点击吸毒人员和在逃人员的时候再去发请求减轻压力

                this.initBindEvent();
            },
            initBindEvent: function () {
                var _this = this;
                // 点击tab切换
                var $parentBody = $(window.parent.document.body);
                $parentBody.on('click', '.tab-con li', function () {
                    var $this = $(this);
                    var index = $this.index();
                    $this.addClass('active').siblings('li').removeClass('active');
                    $(".layui-layer").find('.table-con').eq(index).show().siblings().hide();
                });
                // 点击全国请求服务显示弹窗
                $("#qgService").on('click', function () {
                    _this.queryCountryService();
                    // 在全国请求服务成功以后用layer弹窗
                    var obj = $(".service-country").html();
                    parent.layer.open({
                        type: 1,
                        title: ['全国请求服务', 'background:#2e8ded;color:#fff;'], //显示标题
                        area: ['1200px', '700px'],
                        content: obj,//捕获的元素，注意：最好该指定的元素要存放在body最外层，否则可能被其它的相对元素所影响
                        resize: false,
                        btn: ['确定', '取消'],
                        yes: function (index, layero) {
                            parent.layer.close(index);
                        },
                        btn2: function (index, layero) {
                            layer.close(index);
                        },
                        cancel: function (index, layero) {
                            layer.close(index);
                        }
                    });
                });
                // 点击复用按钮 点击复用按钮其实就是把全国人口的接口的信息复用过去
                var $parentBody = $(window.parent.document.body);
                $parentBody.on('click', '.layui-layer .repeat-use', function () {
                    var $this = $(this);
                    _this.queryCommonAjax(_this.httpUrlObj.qgrk, 'qgrk', 1);
                    parent.layer.close(parent.layer.index);
                });
            },
            queryCountryService: function () {
                var _this = this;
                // 全国常口
                this.queryCommonAjax(this.httpUrlObj.qgrk, 'qgrk', 0);
                // 违法犯罪
                this.queryCommonAjax(this.httpUrlObj.qgwffz, 'wffz');
                // 吸毒人员
                this.queryCommonAjax(this.httpUrlObj.qgxfd, 'xfd');
                // 在逃人员
                this.queryCommonAjax(this.httpUrlObj.qgzt, 'zt');
            },
            // 渲染全国人口人员信息的方法（dom和违法犯罪，吸毒人员，在逃人员不一样）
            renderQgrk: function (obj) {
                var _this = this;
                var htmlArr = [];
                var columnData = obj.columnData[0].data;
                // 单独渲染照片
                var base64Img = columnData.XP;
                if (base64Img) {
                    // $(".por-img img").attr('src', 'data:image/png;base64,' + base64Img);
                    $(".por-img img").attr('src', base64Img);
                }
                htmlArr.push('\
			 <li>\
				 <span>姓名：</span>\
				 <i>', columnData.XM, '</i>\
				 </li>\
			 <li>\
				 <span>曾用名：</span>\
				 <i>', columnData.CYM, '</i>\
			 </li>\
			 <li>\
				 <span>性别：</span>\
				 <i>', columnData.XB_CN, '</i>\
			 </li>\
			 <li>\
				 <span>出生日期：</span>\
				 <i>', _this.handleDate(columnData.CSRQ), '</i>\
			 </li>\
			 <li>\
				 <span>民族：</span>\
				 <i>', columnData.MZ_CN, '</i>\
			 </li>\
			 <li>\
				 <span>身份证号：</span>\
				 <i>', columnData.SFZH, '</i>\
			 </li>\
			 <li>\
				 <span>出生地：</span>\
				 <i>', columnData.CSD_CN, '</i>\
			 </li>\
			 <li>\
				 <span>户口所在地：</span>\
				 <i>', columnData.HKSZD_CN, '</i>\
			 </li>\
			 <li>\
				 <span>籍贯：</span>\
				 <i>', columnData.JGSSX_CN, '</i>\
			 </li>\
			 <!--比较特殊，文字较多-->\
			 <li class="specil">\
				 <span>现住址：</span>\
				 <i>', columnData.ZZXZ, '</i>\
			 </li>\
			 <li>\
				 <span>文化程度：</span>\
			 	 <i>', columnData.WHCD_CN, '</i>\
			 </li>\
			 <li>\
				 <span>服务处所：</span>\
			 	 <i>', columnData.FWCS, '</i>\
			 </li>');
                $(".info-wrapper ul").html(htmlArr.join(''));
            },
            // 渲染违法犯罪，吸毒人员，在逃人员的表格
            renderTabTable: function (res, type) {
                var _this = this;
                // 表头数据
                var theadData = res.columnHearder;
                // 表体数据
                var tbodyData = res.columnData;
                // 违法犯罪
                if (type == 'wffz') {
                    // alert(tbodyData.length);
                    // 总数量
                    $("#wffzCount").text('(' + tbodyData.length + ')');
                    // 表头拼接 // 计划做成活的，但是ui等不满足条件所以做成死的
                    var htmlArr = [];
                    $.each(tbodyData, function (index, item) {
                        htmlArr.push('<tr>');
                        htmlArr.push('\
						<td>', index + 1, '</td>\
						<td>', item.data.XB.cn, '</td>\
						<td>', item.data.SFZH, '</td>\
						<td>', item.data.AJLB.cn, '</td>\
						<td>', item.data.AJBH, '</td>\
						<td>', item.data.CYM, '</td>\
						<td>', item.data.HJDXZ, '</td>\
						<td>', item.data.JZDXZ, '</td>');
                        htmlArr.push('</tr>');
                        // 如果有案件详情的话就另外启一行
                        if (item.data.JYAQ && item.data.JYAQ.length > 0) { // 如果有简要案情
                            htmlArr.push('<tr><td colspan="8">', item.data.JYAQ, '</td></tr>');
                        }
                    });
                    $(".table-wrapper .wffz tbody").html(htmlArr.join(''));
                } else if (type == 'xfd') { // 吸贩毒
                    // 总数量
                    $("#xfdCount").text('(' + tbodyData.length + ')');
                    var theadArr = [];
                    theadArr.push('<th>序号</th>');
                    var colspan = 0;
                    $.each(theadData, function (key, value) {
                        if (key !== 'WFFZSS') {
                            theadArr.push('<th>', value, '</th>');
                            colspan++;
                        }
                    });
                    $(".table-wrapper .xfd thead tr").html(theadArr.join(''));
                    // 表体拼接
                    var tbodyArr = [];
                    $.each(tbodyData, function (index, item) {
                        tbodyArr.push('<tr>');
                        tbodyArr.push('<td>', index + 1, '</td>');
                        $.each(item.data, function (key, value) {
                            if (key !== 'WFFZSS') {
                                if (value.code && value.code.length > 0) {
                                    tbodyArr.push('<td>', value.cn, '</td>');
                                } else {
                                    tbodyArr.push('<td>', value, '</td>');
                                }
                            }
                        });
                        tbodyArr.push('</tr>');
                        if (item.data.WFFZSS && item.data.WFFZSS.length > 0) {
                            tbodyArr.push('<tr><td colspan="', colspan + 1, '">', item.data.WFFZSS, '</td></tr>')
                        }
                    });
                    $(".table-wrapper .xfd tbody").html(tbodyArr.join(''));

                } else if (type == 'zt') { // 在逃
                    // 总数量
                    $("#ztCount").text('(' + tbodyData.length + ')');
                    var theadArr = [];
                    theadArr.push('<th>序号</th>');
                    var colspan = 0;
                    $.each(theadData, function (key, value) {
                        if (key !== 'JYAQ') {
                            theadArr.push('<th>', value, '</th>');
                            colspan++;
                        }
                    });
                    $(".table-wrapper .zt thead tr").html(theadArr.join(''));
                    // 表体拼接
                    var tbodyArr = [];
                    $.each(tbodyData, function (index, item) {
                        tbodyArr.push('<tr>');
                        tbodyArr.push('<td>', index + 1, '</td>');
                        $.each(item.data, function (key, value) {
                            if (key !== 'JYAQ') {
                                if (value.code && value.code.length > 0) {
                                    tbodyArr.push('<td>', value.cn, '</td>');
                                } else {
                                    tbodyArr.push('<td>', value, '</td>');
                                }
                            }
                        });
                        tbodyArr.push('</tr>');
                        if (item.data.JYAQ && item.data.JYAQ.length > 0) {
                            tbodyArr.push('<tr><td colspan="', colspan + 1, '">', item.data.JYAQ, '</td></tr>')
                        }
                    });
                    $(".table-wrapper .zt tbody").html(tbodyArr.join(''));
                }
            },
            // 发送公共的ajax请求的方法(都是一样的参数只是url和返回值不一样而已)
            queryCommonAjax: function (url, type, isRepeat) {
                var _this = this;
                /*
                 * 1.只传递身份证号可以查出来
                 * 2.传递 name  sex  birthday也可以查出来
                 */
                var idcard = $.trim($(".id-card-ul input[name='idcard']").val()); // 身份证号
                var name = $.trim($(".id-card-ul input[name='personName']").val()); // 姓名
                var sex = $.trim($(".id-card-ul input[name='sexCode']").attr('code')); // 性别
                var birthday = $.trim($(".id-card-ul input[name='birthday']").val()); // 出生日期
                $.ajax({
                    url: url,
                    type: 'post',
                    dataType: 'json',
                    contentType: 'application/json',
                    async: false, // 注意这里是同步(按理应该是在全国常口，违法犯罪，吸毒人员，在逃人员三个请求都结束并且数据渲染完成以后再调用layer的)
                    data: JSON.stringify({
                        // version: "02", // 不同地方对应不同version eg:安康 02   北京 03等 。 无用注释掉
                        idcard: idcard, // 身份证号
                        name: name, // 姓名
                        sex: sex, // 性别
                        birthday: birthday // 出生日期
                    }),
                    success: function (res) {
                        if (type == 'qgrk') { // 全国人口
                            if (!isRepeat) { // 非复用
                                _this.renderQgrk(JSON.parse(res));
                            } else { // 复用
                                _this.repeatQgrk(JSON.parse(res));
                            }
                        } else if (type == 'wffz') { // 违法犯罪
                            _this.renderTabTable(JSON.parse(res), 'wffz');
                        } else if (type == 'xfd') { // 吸贩毒人员
                            _this.renderTabTable(JSON.parse(res), 'xfd');
                        } else if (type == 'zt') { // 在逃人员
                            _this.renderTabTable(JSON.parse(res), 'zt');
                        }

                    }
                })
            },
            // 复用去渲染的方法
            repeatQgrk: function (obj) {
                var _this = this;
                var columnData = obj.columnData[0].data;
                var idObj = {
                    'idcard': {'code': 0, 'keyvalue': 'SFZH'}, // 公民身份证号
                    'personName': {'code': 0, 'keyvalue': 'XM'}, // 姓名
                    'sexCode': {'code': 1, 'keyvalue': 'XB'}, // 性别
                    'birthday': {'code': 0, 'keyvalue': 'CSRQ'}, // 出生日期
                    'minzuCode': {'code': 1, 'keyvalue': 'MZ'}, // 民族
                    'doorPlaceCode': {'code': 1, 'keyvalue': 'HKSZD'}, // 户籍地行政区划
                    'doorAddress': {'code': 0, 'keyvalue': 'CSDXZ'}, // 户籍地详址
                    'houseAddress': {'code': 0, 'keyvalue': 'ZZXZ'}, // 居住地详址
                    'cultureCode': {'code': 1, 'keyvalue': 'WHCD'} // 居住地详址
                };

                // 第一部分去复用身份证信息、基本信息等
                $(".base-info-con input").each(function (index, item) {
                    var $this = $(this);
                    var inputName = $this.attr('name');
                    if (idObj[inputName]) { // 有的字段无法复用所以必须判断key的真假
                        var key = idObj[inputName].keyvalue;
                        var code = idObj[inputName].code;
                        if (idObj[inputName].code == 1) { // 因为最终入库的时候要入code显示的时候要显示汉字
                            $this.attr('code', columnData[key].code);
                            $this.val(columnData[key].cn);
                        } else {
                            if (key == 'CSRQ') { // 对出生日期进行特殊处理
                                $this.val(_this.handleDate(columnData[key]));
                            } else {
                                $this.val(columnData[key]);
                            }
                        }
                    }
                });
                // 第二部分去复用相片
                var base64Img = columnData.XP;
                $("#idCardImg img").attr('src', base64Img)
            },
            handleDate: function (oldDate) {
                var newDate = null;
                newDate = oldDate.substring(0, 4) + '-' + oldDate.substring(4, 6) + '-' + oldDate.substring(6);
                return newDate;
            }
        };
        allCountryService.init();

        /*********采集过程中涉及到的公共方法***************************************/
        var baseCollectionAction = {
            init: function () {
                // 初始化去动态计算右侧高度
                this.computerHeight();
                // 初始化执行奇偶行变色
                this.changeColor();
                // 退出登录方法
                this.logOut();
            },
            // 奇偶行变色
            changeColor: function () {
                var _this = this;
                $(".card-table").each(function (index, item) {
                    /*
                     *  规律：
                     *  索引为奇数 其实是第偶数行
                     *  索引为偶数 其实是第奇数行
                     */
                    $(item).find('tr:even').addClass('odd-color');
                });
                /*********************补充表格*************************************/
                $("table").on('mouseover', 'tbody tr', function () {
                    var $this = $(this);
                    $this.addClass('tr-hover');
                }).on('mouseout', 'tbody tr', function () {
                    var $this = $(this);
                    $this.removeClass('tr-hover');
                });
            },
            // 动态计算右侧高度
            computerHeight: function () {
                // 实现左侧固定宽度，右侧自适应布局时计算右边空白的值
                var wH = $(window).height();
                var $mainContent = $(".main-content-wrapper");
                $mainContent.height('100%');
                $(window).resize(function () {
                    var wH = $(window).height();
                    var $mainContent = $(".main-content-wrapper");
                    $mainContent.height('100%');
                });
            },
            // 退出登录
            logOut: function () {
                /*点击退出登录去发请求，如果成功的话就重定性到登录页面*/
                $("#logOut").on('click', function () {
                    $.ajax({
                        type: 'get',
                        url: '/htmisWeb/sys/logout.do',
                        dataType: 'json',
                        success: function (result) {
                            if (result == 1) {
                                window.location.href = "/htmisWeb/login.html";
                            }
                        }
                    })
                });
            },
            // 校验必审核项是否已经采集完成的公用的方法
            checkQcHasFinished: function () {
                var _this = this;
                var flag = false;
                $(".left-collect-con ul li.qc-item").each(function () {
                    var $this = $(this);
                    var tab = $this.data('tab');
                    for (var key in collectionObj) {
                        if (collectionObj[tab]) { // 如果有一次是true说明采集成功
                            return ;
                        }
                    }
                });
            },
            // 日期格式化
            handleDate: function (oldDate) {
                var newDate = null;
                newDate = oldDate.substring(0, 4) + '-' + oldDate.substring(4, 6) + '-' + oldDate.substring(6);
                return newDate;
            }
        };
        baseCollectionAction.init();

        /*********左侧menu菜单通过权限动态抓取*************************************/
        var leftMenu = {
            init: function () {
                // this.initQuery();
                this.initChangeTab();
            },
            // 点击左侧采集项右侧内容切换
            initChangeTab: function () {
                var _this = this;
                $(".left-collect-con").on('click', 'li.base-info', function () {
                    var $this = $(this);
                    var tabType = $this.data('tab');
                    if (tabType !== 'collInfoFlag') {  // 点击非基本信息
                        if (!collectionObj['collInfoFlag']) { // 要判断基本信息是否保存成功
                            layer.msg('请先对基本信息进行采集，并保存成功！', {
                                icon: 1,
                                time: 2000 //2秒关闭（如果不配置，默认是3秒）
                            });
                            return false;
                        }
                    }
                    $(".right-specific-con").find('.' + tabType).show().siblings().hide();
                    $this.find('.img-wrapper').addClass('current-collect').parent().siblings('.base-info').find('.img-wrapper').removeClass('current-collect');
                });
            },
            initQuery: function (pageId) {
                var _this = this;
                $.ajax({
                    url: '/htmisWeb/permission/gcrap.do',
                    type: 'post',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        "columnCondition": {
                            columnNameReq: "0", // 固定 0 设计如此
                            permissionResId: pageId // 设计如此写死即可
                        },
                        "permissionConditon": {
                            "parentId": pageId, // 设计如此写死即可
                            "qcParentId": 245
                        }
                    }),
                    dataType: 'json',
                    success: function (res) {
                        // 得到必审核项(还要校验比审核项是否采集完成)
                        var qcPermission = res.qcPermission;
                        // 强制清空假数据
                        $(".left-collect-con ul").children().remove();
                        var htmlArr = [];
                        $.each(res.collPermission, function (index, item) {
                            if (item.RESTYPE != "simMessageFlag" && item.RESTYPE != "idcardFlag" && item.RESTYPE != 'collFingerFlag' && item.RESTYPE != 'collPhoneFlag' && item.RESTYPE != 'pageBtn') {
                                htmlArr.push('\
						<li class="base-info" data-tab="', item.RESTYPE, '">\
							<div class="img-wrapper ', item.RESTYPE == "collInfoFlag" ? "current-collect" : "", '">\
								<img src="../../../image/collection/', item.RESCLASS, '.png" alt="">\
							</div>\
							<p>', item.RESNAME, '</p>\
							<div class="must-collect ', item.REQUIRED == 1 ? "" : "display-none", '">必</br>采</div>\
							<div class="order">\
								<img src="../../../image/collection/down-arrow.png" alt="">\
							</div>\
						</li>');
                            }
                        });
                        // 循环完毕
                        $(".left-collect-con ul").html(htmlArr.join(''));
                        // 最后一个不需要向下的箭头
                        $(".left-collect-con ul li:last").find('.order').hide();
                        // 比如有10个采集项目，看哪几个是必审核项
                        $(".left-collect-con ul li").each(function (index, item) {
                            var $this = $(this);
                            var tab = $this.data('tab');
                            $.each(qcPermission, function (index2, item2) {
                                if (tab == item2.RESTYPE) {
                                    $this.addClass('qc-item'); // 有这个类名的说明需要审核
                                }
                            });
                        });


                    }
                })
            }
        };
        leftMenu.init();
        /*********************足迹采集************************************/
        var Footer = {
            init: function () {
                this.initBindEvent();
            },
            initBindEvent: function () {
                var _this = this;
                $("#saveFooter").on('click', function () {
                    if (!personId) {
                        alert("请先完成基本信息的采集");
                        return false;
                    }
                    var $this = $(this);
                    var ocx = document.getElementById("captureShoe");
                    var resultJson = ocx.HS_SCAN_GetCapturedData_std(0);
                    // alert(resultJson);
                    layer.msg('足迹获取信息成功', {
                        icon: 1,
                        time: 2000 //2秒关闭（如果不配置，默认是3秒）
                    }, function () {
                        $.ajax({
                            url: '/htmisWeb/personCollect/addOrEditPersonCollect.do',
                            type: 'post',
                            dataType: 'json',
                            contentType: 'application/json',
                            data: JSON.stringify({
                                receivedData: resultJson,
                                startTime: new Date().getTime(),
                                btyCode: "11",
                                personId: personId,
                                btyMessages: []
                            }),
                            success: function (res) {
                                layer.msg('足迹采集成功，请接下来操作', {
                                    icon: 1,
                                    time: 2000 //2秒关闭（如果不配置，默认是3秒）
                                });
                            }
                        })
                    });

                });
            }
        };
        Footer.init();
        /*********************指掌纹*************************************/
        var fingerPalm = {
            init: function () {
                this.initBindEvent();
                this.initObjectHeight();
            },
            initBindEvent: function () {
                var _this = this;
                var lastRes = null;
                $("#saveFingerPalm").on('click', function () {
                    if (!personId) {
                        alert("请先完成基本信息的采集");
                        return false;
                    }
                    var isInit = document.getElementById("ImageOcx").HS_SCAN_Init();
                    if (isInit) {
                        // alert(1);
                        lastRes = document.getElementById("ImageOcx").HS_SCAN_GetCapturedData_std(0);
                        // 测试后台入库
                        $.ajax({
                            url: '/htmisWeb/personCollect/addOrEditPersonCollect.do',
                            type: 'post',
                            dataType: 'json',
                            contentType: 'application/json',
                            data: JSON.stringify({
                                receivedData: lastRes,
                                startTime: new Date().getTime(),
                                btyCode: "1",
                                personId: personId,
                                btyMessages: []
                            }),
                            success: function (res) {
                                alert('指掌纹采集成功了')
                                /*layer.msg('指掌纹采集成功', {
                                 icon: 1,
                                 time: 2000 //2秒关闭（如果不配置，默认是3秒）
                                 });*/
                            }
                        })
                    }
                });
            },
            initObjectHeight: function () { // 为了让控件能够自适应
                var _this = this;
                // 实现左侧固定宽度，右侧自适应布局时计算右边空白的值
                var wH = $(window).height();
                var $fingerPalmCon = $(".finger-palm-con");
                $fingerPalmCon.height(wH - 185);
                $(window).resize(function () {
                    var wH = $(window).height();
                    var $fingerPalmCon = $(".finger-palm-con");
                    $fingerPalmCon.height(wH - 185);
                });
            }
        };
        fingerPalm.init();

        /********基本信息功能(文字字段录入)***************************************/
        /*
         * 1.身份证信息
         * 2.基本信息
         * 3.采集人信息
         */
        var baseInfo = {
            init: function () {
                // 初始化查询所有基本信息
                this.initQueryColumn();
                // 页面的一些点击事件
                this.initBindEvent();
                // 无身份证的处理逻辑
                this.initNoIdCard();
                // 注册绑定入库的事件方法
                this.initSaveAction();

                // 公民身份证号联动
                this.initBlurIdCard();
                // 户籍地行政规划联动
                this.initDoorPlaceCode();
            },
            // 查询基本信息
            initQueryColumn: function () {
                var _this = this;
                $.ajax({
                    type: 'get',
                    url: "/htmisWeb/person/queryPersonMessages.do",
                    dataType: 'json',
                    cache: false,
                    data: {
                        // 页面pageID，设计如此，写死即可 400001
                        permissionResId: '191',
                        // 文字信息采集展示列dataType默认为 03
                        dataType: '03'
                    },
                    success: function (data) {
                        var jsonData = data;
                        if (!$.isEmptyObject(jsonData["columns"])) {
                            var clodata = JSON.parse(jsonData["columns"]["03"]);
                        }
                        var nydata = jsonData.nyData;
                        // var nydata =
                        /*
                         * 对参数进行说明
                         * CODENAME: 字典类型的字典代码: eg: GXSDM
                         * COLDISPNAME: 对应字段汉字 eg: 文化程度
                         * COLDISPWIDTH: 1(三分之一行) 2(三分之二行) 3(多行，也就是多行文本框)
                         * COLUMNNAME：拼键值对的时候的key值 例如 {"ZJHM":14277199005160516}  ZJHM就是key
                         * COLUMNTYPE: 01 普通输入 02字典选择 03时间输入
                         */
                        // 第一部分渲染clodata
                        var htmlArr = new Array();
                        $.each(clodata, function (index, item) {
                            var codeName = item.CODENAME; // 字典代码
                            var colDispName = item.COLDISPNAME; // 汉字描述
                            var colDispWidth = item.COLDISPWIDTH; // 宽度三分之一行，三分之二行和全行
                            var columnName = item.COLUMNNAME; // 往后台拼接键值对的时的key
                            var columnType = item.COLUMNTYPE; // 类型
                            // 字典类型（带树的字典和不带树的字典=>占三分之一行，还是占三分之二行）
                            if (columnType == '2') {
                                if (codeName == 'XZQHDM') { // 只有字典代码是：先住地行政区划才加树形结构选择
                                    htmlArr.push('\
								<li class="fl filter self-select-main', colDispWidth == 2 ? "persent-66" : "", '" data-select="0" requiredvalue="', columnName, '">\
									<div class="left-text fl">', colDispName, '：</div>\
									<div class="input-wrapper">\
										<div class="dict-input drop-down">\
										<input type="text" placeholder="请选择', colDispName, '" class="self-search-input" data-columnname="', codeName, '"  data-tablename="T_SYS_DICT" name="', columnName, '">\
										</div>\
										<img src="../image/collection/right-tree.png" alt="">\
										<ul class="search-result display-none">\
										</ul>\
									</div>\
									<div class="red-star display-none">*</div>\
								</li>');
                                } else { // 其他字典代码
                                    htmlArr.push('\
								<li class="fl ', colDispWidth == 2 ? "persent-66" : "", '" requiredvalue="', columnName, '">\
									<div class="left-text fl">', colDispName, '：</div>\
									<div class="input-wrapper scroll-input" codeName="', codeName, '" hasclicked="true">\
										<input class="pointer-input" type="text" placeholder="请选择', colDispName, '" readonly="" unselectable="on" code="" name="', columnName, '">\
										<img src="../image/collection/right-down.png" alt="">\
										<ul class="select-ul display-none">\
										</ul>\
									</div>\
									<div class="red-star display-none">*</div>\
								</li>');
                                }
                            }
                            // 普通框子类型(=>占三分之一行还是占三分之二行 如果width是3就是多行文本框)
                            if (columnType == '1') {
                                if (colDispWidth == 3) { // 多行文本框
                                    htmlArr.push('\
								<li class="dif-textarea fl" requiredvalue="', columnName, '">\
									<div class="left-text fl">', colDispName, '：</div>\
									<div class="textarea-wrapper">\
										<textarea name="', columnName, '" id="" cols="25" rows="3"></textarea>\
									</div>\
									<div class="red-star display-none">*</div>\
								</li>');
                                } else { // 单行文本框里面分为占三分之一和三分之二的
                                    htmlArr.push('\
							<li class="fl ', colDispWidth == 2 ? "persent-66" : "", '" requiredvalue="', columnName, '">\
								<div class="left-text fl">', colDispName, '：</div>\
								<div class="input-wrapper">\
									<input type="text" placeholder="请输入" name="', columnName, '">\
								</div>\
								<div class="red-star display-none">*</div>\
							</li>');
                                }
                            }
                        });
                        // 循环结束后渲染dom
                        $(".base-info-ul ul").html(htmlArr.join(''));
                        // 第二部分悬案nydata
                        $("#nyData ul li .under-line").each(function (index, item) {
                            var $this = $(this);
                            var nykey = $this.attr('nykey');
                            var nycode = $this.attr('nycode');
                            $this.html(nydata[nykey]);
                            if (nycode) { // 因为采集人单位比较特殊，所以nykey存汉字  nycode存code
                                $this.attr('nycode', nydata[nycode]);
                            }
                        });
                        // 2018.07.13 增加逻辑 必须等动态的基本信息查询完，dom渲染完以后再去初始化查询必填项
                        // 初始化的时候还要执行一下必填项（初始化第一个参数为0 0必须是字符串形式的0=>设计如此只需要这样传即可,异步嵌套异步）
                        _this.queryRequired("0", "");
                    }
                });
            },
            // 业务集合
            initBindEvent: function () {
                var _this = this;
                /*点击需要查询字典的去查询字典:比如:人员类型、证件类型、文化程度等*/
                $(".base-info-con").on('click', '.scroll-input', function () {
                    var $this = $(this);
                    // 先让所有的隐藏
                    $(".input-wrapper>ul").hide();
                    var codeName = $this.attr('codeName');
                    var hasClicked = $this.attr('hasClicked');
                    if (hasClicked == 'true') {
                        $.ajax({
                            url: '/htmisWeb/base/dictInputSerch.do',
                            type: 'get',
                            dataType: 'json',
                            data: {
                                checkData: '',
                                columnName: codeName,
                                tableName: 'T_SYS_DICT'
                            },
                            success: function (res) {
                                var htmlArr = [];
                                $.each(res, function (index, item) {
                                    htmlArr.push('<li value="', item.dictKey, '">', item.dictValue, '</li>')
                                });
                                $this.find('ul.select-ul').html(htmlArr.join('')).show();
                                $this.attr('hasClicked', false);
                            }
                        })
                    } else {
                        $this.find('ul.select-ul').show();
                        return false;
                    }
                });
                $(document.body).click(function () {
                    var $this = $(this);
                    $(".input-wrapper ul").hide();
                });
                $(".base-info-con").on('click', '.select-ul li', function () {
                    var $this = $(this);
                    $this.parent().siblings('input').val($this.text());
                    $this.parent().hide();
                    $this.parent().siblings('input').attr('code', $this.attr('value'));
                    // 去查当前条件下的必填项
                    var columnNameReq = $this.parent().siblings('input').attr('name');
                    var columnNameReqValue = $this.attr('value');
                    _this.queryRequired(columnNameReq, columnNameReqValue);
                    return false;
                });
            },
            // 身份证失去焦点
            initBlurIdCard: function () {
                var _this = this;
                $("#idCardLi").on('blur', 'input[name="idcard"]', function () {
                    /*
                     *  业务流程:
                     *  如果勾选了无身份证就不用校验           优先级最高
                     *  如果身份证不符合规则也不用进行下列联动   优先级高
                     */
                    var $noIdcard = $("#noIdcard");
                    var isChecked = $noIdcard.prop('checked');
                    if (!isChecked) { // 没有勾选无身份证号时才去接下来的校验
                        var regIdNo = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;
                        var $this = $(this);
                        var thisVal = $this.val().replace(/\s/g, "");
                        if (thisVal.length > 0 && regIdNo.test(thisVal)) {
                            var birthDayValue = thisVal.substring(6, 10) + '-' + thisVal.substring(10, 12) + '-' + thisVal.substring(12, 14);
                            var sexNumber = thisVal.substring(16, 17);
                            var sexValue = sexNumber % 2 == 0 ? "女" : "男";
                            var sexCode = sexValue == "女" ? 2 : 1;
                            $this.parents('.id-card-ul').find('input[name="birthday"]').val(birthDayValue);
                            $this.parents('.id-card-ul').find('input[name="sexCode"]').val(sexValue).attr('code', sexCode);
                        } else {
                            layer.msg('您的身份证号不符合规则，请重新输入', {
                                icon: 1,
                                time: 2000 //2秒关闭如果不配置，默认是3秒）
                            });
                        }
                    }

                });
            },
            // 户籍地行政区划联动
            initDoorPlaceCode: function () {
                var _this = this;
                $("#doorPlaceCodeLi").on('blur', 'input[name="doorPlaceCode"]', function () {
                    /*
                     *  业务流程:
                     *  户籍地行政区划失去焦点的时候，如果有值要把值赋在户籍地详址的input框
                     */
                    var $this = $(this);
                    var thisValue = $.trim($this.val());
                    if (thisValue.length > 0) {
                        $this.parents('.id-card-ul').find('input[name="doorAddress"]').val(thisValue);
                    }
                });
            },
            // 点击无身份证
            initNoIdCard: function () {
                var _this = this;
                var flag = true;
                $("#noIdcard").on('change', function () {
                    /*
                     *  分为两种情况
                     *  初始化是必填项
                     *  初始化不是必填项
                     */
                    var $this = $(this);
                    var isChecked = $this.prop('checked'); // 勾选上为true，没有勾选上为false
                    var isVisible = $("#idCardLi").find('.red-star').is(":visible"); // true显示  false隐藏
                    if (isChecked) { // 如果当前单选框被选中
                        if (isVisible) { // 身份证是必填项
                            $("#idCardLi").find('.red-star').hide();// 隐藏掉
                            flag = false;
                        } else { // 身份证不是必填项

                        }
                    } else { // 没有被选中
                        if (!flag) { // 如果公民身份证号这个input框是比填项
                            $("#idCardLi").find('.red-star').show();// 隐藏掉
                        }
                    }
                });
            },
            // 查询必填项的方法
            queryRequired: function (columnNameReq, columnNameReqValue) {
                /*  业务需求：
                 不同的条件下对应的查询条件不同：
                 不同条件指的是:不同的人员类型 或 不同的国籍 或 不同的职业  或 不同的证件类型等。
                 所以要传递两个参数如下:
                 *  columnNameReq      某字段的必填信息，某字段。eg: 人员类别:RYLBDM 等
                 *  columnNameReqValue 具体的值比如: 其他人员(99) 保安人员(09) 被盘问人员(07)等
                 */
                var _this = this;
                $.ajax({
                    type: 'post',
                    url: "/htmisWeb/column/getColumnRequired.do",
                    dataType: 'json',
                    contentType: 'application/json',
                    cache: false,
                    data: JSON.stringify({
                        columnCondition: {
                            "columnNameReq": columnNameReq,
                            "columnNameReqValue": columnNameReqValue,
                            "permissionResId": 191 // 这个id是从左侧采集项拿过来的
                        }
                    }),
                    success: function (data) {
                        if (!$.isEmptyObject(data)) { // 首先保证data不是空对象
                            // 必填
                            if (JSON.parse(data["columnMessageReq"])) { // JSON.parse(data["columnMessageReq"])有null的情况
                                var fillData = JSON.parse(data["columnMessageReq"])["0"];
                                if (fillData) { // 再保证clodata有值 （1代表必填  -1代表非必填）
                                    $(".id-card-ul ul li,.base-info-ul ul li").each(function (index, item) {
                                        var $this = $(this);
                                        var requiredValue = $this.attr('requiredvalue');
                                        $.each(fillData, function (key, value) {
                                            if (requiredValue == key && value == 1) {
                                                $this.find('.red-star').show();
                                            } else if (requiredValue == key && value == -1) {
                                                $this.find('.red-star').hide();
                                            }
                                        });
                                        /*
                                         *  增加逻辑  每次查询必填项的时候都要先判断无身份证这个checkbox是否是勾选状态 如果是的话
                                         *  不管查出来的身份证号是否是必填，都强制让其下的 .red-star 隐藏
                                         *
                                         */
                                        var isChecked = $("#noIdcard").prop('checked');
                                        if (isChecked) { // 如果当前单选框被选中
                                            $("#idCardLi").find('.red-star').hide();// 隐藏掉
                                        }
                                    });
                                }
                                // 必采(初始化时 pickData 的结果为假值)
                                var pickData = JSON.parse(data["columnMessageReq"])["1"];
                                if (pickData) {
                                    $(".left-collect-con ul li").each(function (index, item) {
                                        var $this = $(this);
                                        var requiredValue = $this.attr('data-tab');
                                        $.each(pickData, function (key, value) {
                                            if (requiredValue == key && value == 1) {
                                                $this.find('.must-collect').show();
                                            } else if (requiredValue == key && value == -1) {
                                                $this.find('.must-collect').hide();
                                            }
                                        });
                                    });
                                }
                            }
                        }
                    }
                });
            },
            // 保存信息去入库 （身份证信息，基本信息，采集人信息都要入库）
            initSaveAction: function () {
                var _this = this;
                $("#saveBaseBtn").on('click', function () {
                    var flag = false;
                    // 身份证的正则
                    var regIdNo = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;
                    // 点击保存的时候首先校验公民身份证号码
                    var idCardVal = $.trim($(".id-card-ul input[name='idcard']").val());
                    if (idCardVal.length > 0) {
                        if (!regIdNo.test(idCardVal)) {
                            layer.msg('身份证号不符合要求，请重新输入', {
                                icon: 1,
                                time: 2000 //2秒关闭如果不配置，默认是3秒）
                            });
                            return false;
                        }
                    }
                    // 第一步:校验必填项:
                    $(".id-card-ul .red-star:visible,.base-info-ul .red-star:visible").each(function (index, item) {
                        var $this = $(this);
                        var oldMsg = $this.parents('li').find('input').val();
                        var requiredMsg = $this.parents('li').find('.left-text').html().replace('：', '') + '未填写或选择';
                        if ($.trim(oldMsg).length == 0) {
                            // console.log(oldMsg); // 首先校验必填项
                            layer.msg(requiredMsg, {
                                icon: 1,
                                time: 2000 //2秒关闭如果不配置，默认是3秒）
                            });
                            flag = true;
                            return false;
                        }
                    });
                    if (flag) return;
                    // 第三步校验是数据是否符合规则(当前只校验身份证)
                    var idInputValue = $.trim($("#idCardLi input").val());
                    if (idInputValue.length > 0 && !regIdNo.test(idInputValue)) {
                        layer.msg('身份证号不符合要求，请重新输入', {
                            icon: 1,
                            time: 2000 //2秒关闭如果不配置，默认是3秒）
                        });
                        flag = true;
                        return false;
                    }
                    // 第三步:提交信息
                    // 通过basics方法整理数据
                    if (flag) return;
                    var basics = _this.getBasics();
                    $.ajax({
                        type: 'post',
                        url: "/htmisWeb/person/addOrEditPersonInfo.do",
                        dataType: 'json',
                        contentType: 'application/json',
                        cache: false,
                        data: JSON.stringify({
                            basics: basics,
                            base64: '',
                            personId: personId, // 初始传递 null  新增成功之后personId就有值了
                            beginTime: new Date().getTime()
                        }),
                        success: function (res) {
                            if (!personId) {
                                layer.msg('新增人员成功', {
                                    icon: 1,
                                    time: 2000 //2秒关闭（如果不配置，默认是3秒）
                                });
                            } else {
                                layer.msg('修改人员成功', {
                                    icon: 1,
                                    time: 2000 //2秒关闭（如果不配置，默认是3秒）
                                });
                            }
                            var jsonRes = JSON.parse(res);
                            personId = jsonRes.personId;
                            if (personId) { // 证明基本信息已经采过了(返回id证明入库成功了)
                                collectionObj['collInfoFlag'] = 1;
                            }
                        }
                    });
                });
            },
            // 得到文字信息对象(提交到后台的是json串)
            getBasics: function () {
                var _this = this;
                var basicsObj = new Object();
                var $inputs = $(".base-info-con input,.base-info-con textarea");
                basicsObj['personId'] = '';
                // 身份证信息，基本信息
                $inputs.each(function (index, item) {
                    var $this = $(this);
                    var itemName = $this.attr('name');
                    var itemValue = $this.val();
                    var itemCode = $this.attr('code');
                    // ajax提交表单当前业务有两种类型的表单 1.直接提交value(.val())的，需要提交code的又是讨厌的字典
                    var codeType = $this.hasClass('pointer-input') || $this.hasClass('self-search-input');
                    // 当前的input或者textarea有这两个类名的说明需要提交code不能提交value
                    if (codeType) {
                        basicsObj[itemName] = itemCode;
                    } else {
                        basicsObj[itemName] = itemValue;
                    }
                });
                // 捺印人信息
                $(".specific-info .under-line").each(function (index, item) {
                    var $this = $(this);
                    var itemName = $this.attr('name');
                    if (itemName == 'nyunitCode') {
                        basicsObj[itemName] = $this.attr('nycode');
                    } else {
                        basicsObj[itemName] = $this.html();
                    }
                });
                return basicsObj;
            }
        };
        baseInfo.init();
        /********电脑信息读取*************************************************/
        var computerInfo = {
            init: function () {
                var _this = this;
                _this.computerInfo = null;
                this.initBindEvent();
                // 注册入库事件
                this.initSaveComputer();
            },
            // 注册一些事件操作
            initBindEvent: function () {
                var _this = this;
                // 点击读取信息
                $("#readActive").on('click', function () {
                    var ocx = document.getElementById("readPCInfo");
                    var jsonObjStr = ocx.ReadPCInfo();
                    // alert(jsonObj)
                    // _this.renderActiveObj(JSON.parse(jsonObj));
                    _this.computerInfo = JSON.parse(jsonObjStr);
                    _this.renderActiveObj(_this.computerInfo);
                });
                // 点击电脑列表去渲染不同的信息
                $(".computer-con tbody").on('click', 'tr', function () {
                    var $this = $(this);
                    var index = $this.index();
                    // alert(index);
                    // var jsonObj = $this.parent('tbody').attr('pclist');
                    var jsonObj = _this.computerInfo.result;
                    var computeritemValue = jsonObj[index]['goodsComputer'];
                    _this.renderEquipment(computeritemValue);
                }).on('click', '.delete-item', function () {
                    var $this = $(this);
                    $this.parents('tr').remove();
                    var index = $this.attr('index');
                    // alert($this.attr('index'));
                    _this.computerInfo.result.splice(index, 1);
                    _this.renderResultArr(_this.computerInfo.result);
                    return false;
                });
            },
            // 渲染整个电脑的json
            renderActiveObj: function (jsonObj) {
                var isOk = jsonObj.isOK;
                if (isOk) { // 如果读取成功
                    this.renderResultArr(jsonObj.result);
                } else { // 如果读取失败
                    layer.msg('电脑读取失败，请重新操作', {
                        icon: 1,
                        time: 2000 //2秒关闭（如果不配置，默认是3秒）
                    });
                }
            },
            // 渲染电脑json里面的result字段
            renderResultArr: function (arrObj) {
                var _this = this;
                // 第一部分:右侧电脑列表渲染
                var computerListArr = [];
                // 把result放在父元素的自定义属性上
                $(".pc-list-con table tbody").attr('pclist', JSON.stringify(arrObj));
                $.each(arrObj, function (index, item) {
                    computerListArr.push('\
			<tr class="', index % 2 !== 0 ? "odd-color" : "", '">\
				<td>', index + 1, '</td>\
				<td>', item.goodsComputer.biosSn, '</td>\
				<td>\
					<button class="delete-item" index="', index, '"><img src="../../image/collection/delete-btn.png" alt=""></button>\
				</td>\
			</tr>');
                });
                // 循环完成以后渲染dom
                $(".computer-con tbody").html(computerListArr.join(''));
                // 去渲染电脑设备列表里面的第一个
                if (arrObj.length > 0) {
                    this.renderEquipment(arrObj[0].goodsComputer);
                }
            },
            // 公共的渲染(设备,采集信息,CPU、BIOS,网卡,硬盘信息)的方法=>(初次渲染和点击不同的设备去渲染)
            renderEquipment: function (info) {
                var _this = this;
                $(".pc-info-wrapper .info-line").each(function () {
                    var $this = $(this);
                    var renderKey = $this.attr('backvalue');
                    var renderValue = info[renderKey];
                    $this.html(renderValue);
                });
            },
            // 电脑信息入库
            initSaveComputer: function () {
                var _this = this;
                $("#saveComputerInfo").on('click', function () {
                    if (!personId) {
                        layer.msg('请先完成基本信息的采集', {
                            icon: 1,
                            time: 2000 //2秒关闭（如果不配置，默认是3秒）
                        });
                        return false;
                    }
                    var receivedData = _this.computerInfo.result;
                    $.ajax({
                        type: 'post',
                        url: "/htmisWeb/goodsCollect/addGoodsCollect.do",
                        dataType: 'json',
                        contentType: 'application/json',
                        cache: false,
                        data: JSON.stringify({
                            "receivedData": receivedData,
                            "personId": personId,
                            "startTime": new Date().getTime(),
                            "goodsBtyCode": 5
                        }),
                        success: function (data) {
                            var result = data.result;
                            if (result) {
                                // collComputerFlag 置为1 说明电脑信息已经采集过了
                                collectionObj['collComputerFlag'] = 1;
                                layer.msg('电脑信息入库成功', {
                                    icon: 1,
                                    time: 2000 //2秒关闭（如果不配置，默认是3秒）
                                });
                            } else {
                                layer.msg('电脑信息入库失败，请稍后再试', {
                                    icon: 1,
                                    time: 2000 //2秒关闭（如果不配置，默认是3秒）
                                });
                            }
                        }
                    });
                })
            }

        };
        computerInfo.init();
        /************关系人*************************************************/
        var relationship = {
            init: function () {
                this.initBindEvent();
            },
            // 初始化绑定事件
            initBindEvent: function () {
                var htmlStr = '\
			<div class="relationship-item">\
				<ul class="persent-ul clear">\
				<li class="fl">\
					<div class="left-text fl">人员关系：</div>\
					<div class="input-wrapper scroll-input" codename="JDRYGXDM" hasclicked="true">\
						<input type="text" placeholder="请选择人员关系" readonly="" unselectable="on" code="" name="relativesCode" class="pointer-input">\
						<img src="../image/collection/right-down.png" alt="">\
						<ul class="select-ul display-none">\
						</ul>\
					</div>\
				</li>\
				<li class="fl">\
					<div class="left-text fl">姓名：</div>\
					<div class="input-wrapper"><input type="text" placeholder="请输入" name="relativesName"></div>\
				</li>\
				<li class="fl">\
					<div class="left-text fl">性别：</div>\
					<div class="input-wrapper scroll-input" codename="XBDM" hasclicked="true">\
						<input type="text" placeholder="请选择性别" readonly="" unselectable="on" code="" name="relativesSexCode" class="pointer-input">\
						<img src="../image/collection/right-down.png" alt="">\
						<ul class="select-ul display-none">\
						</ul>\
					</div>\
				</li>\
				<li class="fl">\
					<div class="left-text fl">身份证号：</div>\
					<div class="input-wrapper">\
						<input type="text" placeholder="请输入" name="relativesIdcard">\
					</div>\
				</li>\
				<li class="fl">\
					<div class="left-text fl">通讯号码：</div>\
					<div class="input-wrapper">\
						<input type="text" placeholder="请输入" name="relativesPhone">\
					</div>\
				</li>\
				<li class="fl" style="width:100%;">\
					<div class="left-text fl">地址：</div>\
					<div class="input-wrapper">\
						<input type="text" placeholder="请输入" name="relativesAddress">\
					</div>\
				</li>\
				</ul>\
				<div class="change-btn">\
					<div class="disabled-btn clear display-none">\
						<!--删除按钮-->\
						<span class="fr delete"><img src="../image/collection/delete-btn.png" alt=""></span>\
						<!--编辑按钮-->\
						<span class="fr edit" style="margin-right:35px;margin-top:1px;"><img src="../image/collection/edit-btn.png" alt=""></span>\
					</div>\
					<div class="edit-btn clear">\
						<!--确定按钮-->\
						<span class="sure fr" style="margin-right:20px;"><img src="../image/collection/sure-right.png" alt=""></span>\
					</div>\
				</div>\
			</div>';
                $("#addRelationship").on('click', function () {
                    $('.relationship-info-ul').append(htmlStr);
                });
                // 点击关系人里面的
                $(".relationship-con").on('click', '.sure', function () { // 确定
                    // 点击对号 变成只读状态
                    var $this = $(this);
                    // 1.置为不可选
                    $this.parents('.relationship-item').find('.persent-ul input').prop('disabled', true);
                    // 2.通过类名置为不可点击的样式
                    $this.parents('.relationship-item').find('.persent-ul').addClass('disabled-ul');
                    // 3.让右上角的下拉箭头图片隐藏
                    $this.parents('.relationship-item').find('.persent-ul .input-wrapper img').hide();
                    // 4.让编辑按钮和删除按钮显示
                    $this.parent().hide().siblings('.disabled-btn').show();
                }).on('click', '.delete', function () { // 删除
                    var $this = $(this);
                    $this.parents('.relationship-item').remove();
                }).on('click', '.edit', function () { // 编辑
                    var $this = $(this);
                    $this.parents('.relationship-item').find('.persent-ul input').prop('disabled', false);
                    // 2.通过类名置为不可点击的样式
                    $this.parents('.relationship-item').find('.persent-ul').removeClass('disabled-ul');
                    // 3.让右上角的下拉箭头图片隐藏
                    $this.parents('.relationship-item').find('.persent-ul .input-wrapper img').show();
                    // 4.让编辑按钮和删除按钮显示
                    $this.parent().hide().siblings('.edit-btn').show();
                });
                var _this = this;
                /*点击需要查询字典的去查询字典:比如:人员类型、证件类型、文化程度等*/
                $(".relationship-con").on('click', '.scroll-input', function () {
                    var $this = $(this);
                    if ($this.parents('.persent-ul').hasClass('disabled-ul')) return;
                    // 先让所有的隐藏
                    $(".input-wrapper>ul").hide();
                    var codeName = $this.attr('codeName');
                    var hasClicked = $this.attr('hasClicked');
                    if (hasClicked == 'true') {
                        $.ajax({
                            url: '/htmisWeb/base/dictInputSerch.do',
                            type: 'get',
                            dataType: 'json',
                            data: {
                                checkData: '',
                                columnName: codeName,
                                tableName: 'T_SYS_DICT'
                            },
                            success: function (res) {
                                var htmlArr = [];
                                $.each(res, function (index, item) {
                                    htmlArr.push('<li value="', item.dictKey, '">', item.dictValue, '</li>')
                                });
                                $this.find('ul.select-ul').html(htmlArr.join('')).show();
                                $this.attr('hasClicked', false);
                            }
                        })
                    } else {
                        $this.find('ul.select-ul').show();
                        return false;
                    }
                });
                $(document.body).click(function () {
                    var $this = $(this);
                    $(".input-wrapper ul").hide();
                });
                $(".relationship-con").on('click', '.select-ul li', function () {
                    var $this = $(this);
                    $this.parent().siblings('input').val($this.text());
                    $this.parent().hide();
                    $this.parent().siblings('input').attr('code', $this.attr('value'));
                    return false;
                });
                // 点击保存的时候对关系人进行入库
                $("#saveRelationShip").on('click', function () {
                    var $this = $(this);
                    var relatives = [];
                    // 当前人员新增了几个关系人数组就几个元素
                    var $relationshipItemUl = $(".relationship-item ul.disabled-ul");
                    if ($relationshipItemUl.length > 0) { // 新增的关系人必须是勾选状态
                        $relationshipItemUl.each(function (ulIndex, ulItem) {
                            var $this = $(this);
                            var $inputs = $this.find('li input');
                            var relativesObj = new Object();
                            $inputs.each(function (inputIndex, inputItem) {
                                var $this = $(this);
                                var inputName = $this.attr('name');
                                // 人员关系和性别需要做特殊处理，显示汉字但是入库要入code
                                if (inputName == 'relativesCode' || inputName == 'relativesSexCode') {
                                    relativesObj[inputName] = $this.attr('code');
                                } else {
                                    relativesObj[inputName] = $this.val();
                                }
                            });
                            // 有几个关系人循环几次，每次循环新增一个关系人
                            relatives.push(relativesObj);
                        });
                        // 对组装好的数据发送ajax请求(relatives长度大于0才入库避免浪费请求)
                        if (relatives.length > 0) {
                            if (!personId) { // 必须保证基本信息采集完成，生成人员编号之后才可以接下来别的采集项，因为别的采集项都要依赖生成的personId
                                layer.msg('请先完成基本信息的采集', {
                                    icon: 1,
                                    time: 2000 //2秒关闭（如果不配置，默认是3秒）
                                });
                                return false;
                            } else {
                                $.ajax({
                                    type: 'post',
                                    url: '/htmisWeb/relatives/addOrEditPersonRelativesInfo.do',
                                    contentType: 'application/json',
                                    dataType: 'json',
                                    data: JSON.stringify({
                                        relatives: relatives,
                                        personId: personId,
                                        beginTime: new Date().getTime()
                                    }),
                                    success: function (res) {
                                        // 入库成功之后
                                        var result = JSON.parse(res).result;
                                        if (result) {
                                            // 把collRelatedFlag置为1，说明已经采过了
                                            collectionObj['collRelatedFlag'] = 1;
                                            layer.msg('新增关系人成功', {
                                                icon: 1,
                                                time: 2000 //2秒关闭（如果不配置，默认是3秒）
                                            });
                                        } else {
                                            layer.msg('新增关系人失败，请稍后再试', {
                                                icon: 1,
                                                time: 2000 //2秒关闭（如果不配置，默认是3秒）
                                            });
                                        }
                                    }

                                });
                            }
                        }
                    } else {
                        layer.msg('请保证新增的关系人事只读状态，再点击保存！', {
                            icon: 1,
                            time: 2000 //2秒关闭（如果不配置，默认是3秒）
                        });
                    }

                });
            }
        };
        relationship.init();

        /************读取身份证信息******************************************/
        $("#readIdcard").on('click', function () {
            var $this = $(this);
            // 第一步:初始化二代证采集控件（isInit初始化成功的返回值）
            var isInit = document.getElementById("idcardObj").InitDevice();

            // 第二步:调用控件的ReadData方法读取身份证信息
            var IDcardInfo = document.getElementById("idcardObj").ReadData();

            // 拿到的是json串需要转换成json对象
            var jsonData = JSON.parse(IDcardInfo);
            var status = jsonData['ResultStatus']; // 是1代表读取成功，0代表不成功
            if (status == 1) { // 成功时才去渲染数据
                var PhotoData = jsonData.PhotoData;
                var FingerData = jsonData.FingerData;

                if (PhotoData) {
                    // var srcStr= 'data:image/jpg;base64,' +  PhotoData;
                    // $("#aaatest").attr('src', url);
                    var htmlArr = [];
                    htmlArr.push('<img src="data:image/jpeg;base64,', PhotoData, '" alt="" id="">');
                    $("#idCardImg").html(htmlArr.join(''));
                    $(".id-card-ul .need-back").each(function (index, item) {
                        var $this = $(this);
                        var backkey = $this.attr('backkey'); // eg: Name
                        var columnName = $this.attr('columnName'); // eg:MINZUCODE
                        if (typeof columnName !== 'undefined') { // 需要翻译的(性别，民族，指纹信息1，指纹信息2，户籍地行政区划)
                            if (columnName == 'ZWDM') { // 指纹信息1和指纹信息二特殊处理
                                // alert(FingerData)
                                if (FingerData) { // 指纹1和指纹2只有在FingerData有值的情况下才会去翻译指纹相关
                                    var checkData = jsonData[backkey]['Pos'];
                                    translate(checkData, columnName, 'T_SYS_DICT', $this);
                                }
                            } else if (columnName == 'XZQHDM') { // 户籍地行政区划
                                var checkData = jsonData['IdCard'].substr(0, 6);
                                translate(checkData, columnName, 'T_SYS_DICT', $this);
                            } else { // 其余
                                var checkData = jsonData[backkey];
                                translate(checkData, columnName, 'T_SYS_DICT', $this);
                            }
                        } else { // 不需要翻译的
                            // alert(index);
                            if (backkey == 'BeginDate') { // 有效期特殊处理
                                $this.val(jsonData[backkey] + '-' + jsonData['EndDate'])
                            } else if (backkey == 'Birthday') {
                                $this.val(baseCollectionAction.handleDate(jsonData[backkey]));
                            } else {
                                $this.val(jsonData[backkey]);
                            }
                        }

                    });
                }
            }
            // 第三步:释放设备
            var isFree = document.getElementById("idcardObj").ReleaseDevice();
        });
        function translate(checkData, columnName, tableName, backCon) {
            // alert(checkData + columnName + tableName)
            var tableName = tableName || 'T_SYS_DICT';
            $.ajax({
                type: 'GET',
                // 后台返回的数据格式一般都是json
                dataType: 'json',
                // 这个url替换成自己的url
                url: '/htmisWeb/base/dictInputSerch.do',
                data: {
                    checkData: checkData,
                    columnName: columnName,
                    tableName: tableName
                },
                success: function (result) {
                    // 成功以后去回填数据
                    if (result.length > 0) {
                        backCon.val(result[0].dictValue);
                        backCon.attr('code', result[0].dictKey);
                    }
                },
                error: function () {
                    // 如果出现异常就提示
                }
            })
        }

        /************银行卡************************************************/
        var bankCard = {
            init: function () {
                this.tempArr = [];
                this.initBindEvent();
                this.initSubmitBank();
            },
            // 初始化绑定一些事件
            initBindEvent: function () {
                var _this = this;
                // 点击读取银行卡
                $("#readBankCard").on('click', function () {
                    var YHKOcx = document.getElementById("YHKObj");
                    // 第一步:初始化银行卡采集控件
                    var YHKInit = YHKOcx.InitDevice();
                    // 第二步:读取信息
                    /*
                     * 读取信息时传递什么从页面上走
                     * 0 (c++供选择的对话框)
                     * 1 (磁条卡)
                     * 2 (芯片卡)
                     * 3 (感应卡、接触卡)
                     * 情况描述:
                     * 同一张卡：不同方式读取的数据项的多少不同 eg:
                     */
                    var jsonObj = { // 数据大概长这样
                        "ResultStatus": "1", // 读取成功标识
                        "Card": [{
                            "Source": "NFC", // 暂无用
                            "CardId": "62920204744831", // 卡号
                            "Bank": "01", // 卡类型: eg；借记卡、信用卡  （01:借记卡)(02:贷记卡)(03:准贷记卡)(04:预付费卡)
                            "Name": "", // 持卡人 大写全拼
                            "ShenFenID": "", // 身份证
                            "ExpiryDate": "221231", // 有效期
                            "DealsNum": "10"
                        }],
                        // 交易记录
                        "Logs": [{
                            "Date": "180415", // 刷卡日期
                            "Time": "030909", // 交易具体时间
                            "Amount": "1000.00", // 交易额
                            "BIZ": "", // 商户
                            "Currency": "5" // 交易数量
                        }]
                    };

                    var bankCardInfo = JSON.parse(YHKOcx.GetCardsInfoEx(0));
                    // 成功再更新ui，不成功不用处理
                    var successStatus = bankCardInfo.ResultStatus;
                    if (successStatus == 1) { // 成功处理 1.每次读取卡完成在下面渲染记录 2.每次读成功在上面增加一条记录
                        // 获取银行卡的基本信息
                        var card = bankCardInfo.Card[0];
                        // 获取银行卡的交易记录
                        var logs = bankCardInfo.Logs;
                        // 渲染银行卡的基本信息 // 因为需要把logs绑定在每一行上面所以传递logs
                        _this.renderBaseCardInfo(card, logs);
                        // 渲染银行卡的交易记录(需要做判断处理)
                        if (logs && logs.length > 0) { // logs可能为空
                            _this.renderCardLog(logs);
                        } else {
                            $("#bankLogsTbody").find('tr').remove();
                            layer.msg('该开片没有交易记录', {
                                icon: 1,
                                time: 3000 //2秒关闭（如果不配置，默认是3秒）
                            }, function () {

                            });
                        }
                    } else {
                        layer.msg('卡片读取失败，请重新操作', {
                            icon: 1,
                            time: 2000 //2秒关闭（如果不配置，默认是3秒）
                        });
                    }
                    // $(".cark-temp").html(bankCardInfo)
                    // 第三步:释放设备
                    var YHKFree = YHKOcx.ReleaseDevice();
                });
                // 点击银行卡的保存按钮执行入库动作
                // 点击不同的银行卡切换交易记录
                $("#bankCardTbody").on('click', 'tr', function () {
                    var $this = $(this);
                    var index = $this.index();
                    _this.renderCardLog(JSON.parse(_this.tempArr[index]));
                }).on('click', '.delete-btn', function () {
                    var $this = $(this);
                    var index = $this.attr('index'); // 一直不变
                    $this.parents('tr').remove();
                    if ($this.parents('tbody').find('tr').length == 0) {
                        $("#bankLogsTbody tr").remove();
                    }
                    return false;
                });
            },
            // 入库动作
            initSubmitBank: function () {
                var _this = this;
                // 银行卡入库
                $("#saveBankCard").on('click', function () {
                    if (!personId) {
                        layer.msg('请先完成基本信息的采集', {
                            icon: 1,
                            time: 2000 //2秒关闭（如果不配置，默认是3秒）
                        });
                        return false;
                    }
                    // 调用方法拿到组装好的数据
                    var receivedData = _this.makeBankSubmitData();
                    var $this = $(this);
                    $.ajax({
                        type: 'post',
                        url: "/htmisWeb/goodsCollect/addGoodsCollect.do",
                        dataType: 'json',
                        contentType: 'application/json',
                        cache: false,
                        data: JSON.stringify({
                            "receivedData": receivedData,
                            "personId": personId,
                            "startTime": new Date().getTime(),
                            "goodsBtyCode": 4
                        }),
                        success: function (data) {
                            //var clodata = JSON.parse(data["columnMessageReq"]);
                            var result = data.result;
                            if (result) {
                                // 把 collBankcardFlag 置为1，说明已经采集过了
                                collectionObj['collBankcardFlag'] = 1;
                                layer.msg('银行卡入库成功', {
                                    icon: 1,
                                    time: 2000 //2秒关闭（如果不配置，默认是3秒）
                                });
                            } else {
                                layer.msg('银行卡入库失败，请稍候再试', {
                                    icon: 1,
                                    time: 2000 //2秒关闭（如果不配置，默认是3秒）
                                });
                            }
                        }
                    });
                });
            },
            // 组装数据
            makeBankSubmitData: function () {
                var _this = this;
                // alert(JSON.stringify(_this.changeTempArr(_this.tempArr)))
                var receivedData = [];
                $("#bankCardTbody tr").each(function (index, item) {
                    var $this = $(this);
                    var index = $this.index();
                    var backItem = {
                        "goodsBankcard": {
                            "bankName": "", // 不管
                            "bankcardId": $this.find("#bankcardId").html(), // 传递
                            "bankcardName": $this.find("#bankcardName").html(), // 传递
                            "bankcardCatalog": "", // 不管
                            "bankcardType": $this.find("#bankcardType").attr('bankcode'), // 传递
                            "bankcardClass": "", // 不管
                            "endTime": $this.find("#endTime").html() // 传递
                        },
                        "goodsBankcardTransrecords": _this.changeTempArr(_this.tempArr[index]) // tempArr是个二维数组
                    };
                    receivedData.push(backItem);
                });
                return receivedData;
            },
            // 重新组装交易记录，因为读取到的key和要提交到后台的key不一样
            changeTempArr: function (oldArr) {
                var _this = this;
                var newArr = new Array();
                $.each(JSON.parse(oldArr), function (index, item) {
                    newArr.push({
                        "storeName": item.BIZ,
                        "exchangeTime": '20' + item.Date.substring(0, 2) + '-' + item.Date.substring(2, 4) + '-' + item.Date.substring(4) + ' ' + item.Time.substring(0, 2) + ':' + item.Time.substring(2, 4) + ':' + item.Time.substring(4, 6),
                        "amounts": item.Amount,
                        "description": ""
                    })
                });
                return newArr;
            },
            // 渲染每张卡的 卡号，姓名，身份证号，卡类型，有效期等。
            renderBaseCardInfo: function (card, logs) { // 每次渲染基本信息的时候都把本次读取的logs给存储一下给存储一下
                var _this = this;
                // 声明新数组存储logs
                this.logsArr = [];
                // 每次采集卡都创建一个新的数组
                var baseArr = new Array();
                // （01:借记卡)(02:贷记卡)(03:准贷记卡)(04:预付费卡)
                var bankType = {
                    01: '借记卡',
                    02: '贷记卡',
                    03: '准贷记卡',
                    04: '预付费卡'
                };

                // 索引
                var index = $("#bankCardTbody").find('tr').length + 1;

                if (logs) {
                    this.tempArr.push(JSON.stringify(logs));
                } else {
                    this.tempArr.push(JSON.stringify([]));
                }

                baseArr.push('\
			<tr data-log=', JSON.stringify(logs), '>\
				<td>', index, '</td>\
				<td id="bankcardId">', card.CardId, '</td>\
				<td id="bankcardName">', card.Name, '</td>\
				<td>', card.ShenFenID, '</td>\
				<td id="bankType" bankcode="', card.Bank, '">', bankType[card.Bank], '</td>\
				<td id="endTime">', card.ExpiryDate, '</td>\
				<td><span class="delete-btn" index="', index - 1, '">删除</span></td>\
			</tr>');
                // 替换dom
                $("#bankCardTbody").append(baseArr.join(''));
            },
            // 渲染每张卡的交易记录
            renderCardLog: function (logs) {
                // logs传递过来的是数组
                // alert(logs.length)
                var _this = this;
                var logsArr = [];
                if (logs.length > 0) {
                    $.each(logs, function (index, item) {
                        logsArr.push('\
		<tr>\
			<td>', index + 1, '</td>\
			<td>', item.Date, '</td>\
			<td>', item.Time, '</td>\
			<td>', item.Amount, '</td>\
			<td>', item.BIZ, '</td>\
			<td>', item.Currency, '</td>\
		</tr>');
                    });
                    // 循环结束替换dom
                    $("#bankLogsTbody").html(logsArr.join(''));
                } else {
                    $("#bankLogsTbody").find('tr').remove();
                }
            }
        };
        bankCard.init();

        /**********************头部导航栏**********************************/
        var headTab = {
            init: function () {
                this.initQueryParent();
                // pageId 变量 渲染左侧menu的时候用
                this.pageId = null;
            },
            // 初始化查询根节点
            initQueryParent: function () {
                var _this = this;
                $.ajax({
                    url: '/htmisWeb/permission/getSysPermissionResListByPid.do',
                    type: 'post',
                    dataType: 'json',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        roleType: 2,
                        parentId: '',
                        openFlag: 1,
                        resType: 'module'
                    }),
                    success: function (res) {
                        // res 返回来的是串必须强制转成普通对象
                        var res = JSON.parse(res);
                        _this.pageId = _this.getPageId(res[0].resPath, 'pageId');
                        // 因为左侧必采项的请求参数依赖这个所以必须在这次请求完成之后发起该请求
                        // 其实本应该从父页面去拿，但是涉及到ajax异步的问题(父页面的那个ajax方法改成同步也可以)
                        leftMenu.initQuery(Number(_this.pageId));
                    }
                })
            },
            // 获取id的方法
            getPageId: function (url, name) {
                var _this = this;
                var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
                var search = url.substr(url.indexOf('?'));
                var r = search.substr(1).match(reg);
                if (r != null) return (r[2]);
                return '';
            }
        };
        headTab.init();
        /**********************sim卡采集相关*******************************/
        var simObj = {
            init: function () {
                this.initGoGather();
                // 手机号失去焦点和双击切换
                this.initBlurDouble();
                // 点击通讯录弹窗
                this.initMailBtn();
                // 点击短信息弹窗
                this.initSmsBtn();
                // 通讯录点击删除
                this.initDelete();
                // sim卡的保存入库
                this.initSaveSimCard();
                this.simArr = [];

            },
            /*点击查看通讯录*/
            initMailBtn: function () { // 通讯录条数
                var _this = this;
                $(".sim-card-con").on('click', '.mail-btn', function () {
                    var $this = $(this);
                    var index = $this.parent('tr').attr('index') - 1;
                    // alert(index)
                    // 上来先强制性隐藏
                    $("#mailListCon .no-data").hide();
                    // 上来先强制性清空dom
                    $("#mailListCon tbody tr").remove();
                    // 去渲染通讯录注意索引的控制
                    // alert(JSON.stringify(_this.simArr[index].goodsSimDirectorys))
                    // $("#test").html(JSON.stringify(_this.simArr));
                    _this.renderGoodsSimDirectorys(_this.simArr[index].goodsSimDirectorys);
                    var obj = $(".mail-wrapper").html();
                    parent.layer.open({
                        type: 1,
                        title: ['通讯录信息', 'background:#2e8ded;color:#fff;'], //显示标题
                        area: ['1000px', '500px'],
                        content: obj,//捕获的元素，注意：最好该指定的元素要存放在body最外层，否则可能被其它的相对元素所影响
                        resize: false,
                        btn: ['确定', '取消'],
                        yes: function (index, layero) {
                            layer.close(index);
                        },
                        btn2: function (index, layero) {
                            layer.close(index);
                        },
                        cancel: function (index, layero) {
                            layer.close(index);
                        }
                    });
                });
            },
            /*点击查看短信息*/
            initSmsBtn: function () { // 短信息条数
                var _this = this;
                $(".sim-card-con").on('click', '.sms-btn', function () {
                    var $this = $(this);
                    var index = $this.parent('tr').attr('index') - 1;
                    // 上来先强制性隐藏
                    $("#smsListCon .no-data").hide();
                    // 上来先强制性清空dom
                    $("#smsListCon .tbody tr").remove();
                    _this.renderGoodsSimSmss(_this.simArr[index].goodsSimSmss);
                    var obj = $(".sms-wrapper").html();
                    parent.layer.open({
                        type: 1,
                        title: ['短信息', 'background:#2e8ded;color:#fff;'], //显示标题
                        area: ['1000px', '500px'],
                        content: obj,//捕获的元素，注意：最好该指定的元素要存放在body最外层，否则可能被其它的相对元素所影响
                        resize: false,
                        btn: ['确定', '取消'],
                        yes: function (index, layero) {
                            layer.close(index);
                        },
                        btn2: function (index, layero) {
                            layer.close(index);
                        },
                        cancel: function (index, layero) {
                            layer.close(index);
                        }
                    });
                });
            },
            initDelete: function () {
                var _this = this;
                $("#simCardTbody").on('click', '.delete-sim-item', function () {
                    var $this = $(this);
                    var index = $this.parents('tr').attr('index') - 1;
                    $this.parents('tr').remove();
                    _this.simArr.splice(index, 1);
                    // 删除以后重新渲染
                    if (_this.simArr.length > 0) {
                        _this.refreshGoodSim();
                    }
                });
            },
            initGoGather: function () {
                var _this = this;
                $("#readSimCard").on('click', function () {
                    var $this = $(this);
                    var simOcx = document.getElementById("simObj");
                    //	初始化银行卡采集控件
                    var simInit = simOcx.InitDevice();
                    // $("#cao").html(simOcx.GetCardsInfo())
                    // alert(simOcx.GetCardsInfo());
                    var simInfo = JSON.parse(simOcx.GetCardsInfo());
                    // alert(simOcx.GetCardsInfo())
                    // alert(simInfo)
                    _this.simArr.push(simInfo); // 每次读取成功往甩里面push一个读取到的结果
                    // alert(2)
                    /*
                     {
                     "goodsSim": {
                     "imei": "", // IMEI号码
                     "imsi": "", // IMSI号码
                     "iccid": "89860313105123763831", // SIM卡Id
                     "directoryNum": 0, // 通讯录条数
                     "smsNum": 0, // 短信息条数
                     "billsNum": 3 // 通话记录条数
                     },
                     "goodsSimSmss": [ // 短信息相关
                     {
                     "transNumber":"联系电话",
                     "receive":"收发：1、收0发",
                     "smsphone":"短信中心的号码",
                     "receiveTime":"收到时间",
                     "content":"短息内容"
                     }

                     ],
                     "goodsSimDirectorys": [{ // 通讯录相关
                     "directoryPhone":"通讯录中的号码",
                     "directoryName":"通讯录中号码的名称"
                     },
                     ],  // 通话记录相关
                     "goodsSimBillss": [{
                     "transNum":"联系电话",
                     "receive":"收发：1、收0发",
                     "callTime":"拨打时间",
                     "duraTime":"通话时长",
                     "billsType":"类型：1、已接来电 2、未接来电 3、已拨电话"
                     }
                     ]
                     }
                     */
                    /*
                     *  读取出来的信息分为几部分
                     *  goodsSim:{IMEI号码，短信条数，通讯录条数，}
                     *  goodsSimSmss 短信相关
                     *  goodsSimDirectorys 通讯录相关
                     */
                    var goodsSim = simInfo.goodsSim; // 号码 id 和条数等
                    var goodsSimSmss = simInfo.goodsSimSmss; // 短信
                    var goodsSimDirectorys = simInfo.goodsSimDirectorys; // 通讯录
                    var simFree = simOcx.ReleaseDevice();
                    _this.renderGoodsSim(goodsSim);
                });
            },
            /*渲染通讯录*/
            renderGoodsSimDirectorys: function (diArr) {
                var _this = this;
                var htmlArr = [];
                if (diArr.length > 0) {
                    $.each(diArr, function (index, item) {
                        htmlArr.push('\
				<tr>\
					<td>', index + 1, '</td>\
					<td>', item.directoryName, '</td>\
					<td>', item.directoryPhone, '</td>\
				</tr>');
                    });
                    // 循环结束后渲染dom
                    $("#mailListCon tbody").html(htmlArr.join(''));
                    // 奇偶行变色
                    baseCollectionAction.changeColor();
                } else {
                    $("#mailListCon .no-data").show();
                }

            },
            /*渲染短消息*/
            renderGoodsSimSmss: function (smArr) {
                var _this = this;
                var htmlArr = [];
                if (smArr.length > 0) {
                    $.each(smArr, function (index, item) {
                        var receiveOrSend = item.receive == 1 ? "发送" : "接收";
                        var receiveOrsendStyle = item.receive == 1 ? "receive-color" : "send-color";
                        htmlArr.push('\
			<tr>\
				<td>', index + 1, '</td>\
				<td class="', receiveOrsendStyle, '">', receiveOrSend, '</td>\
				<td>', item.smsphone, '</td>\
				<td>', item.receiveTime, '</td>\
				<td>', item.content, '</td>\
			</tr>');
                    });
                    // 循环完成以后替换dom
                    $("#smsListCon tbody").html(htmlArr.join(''));
                    // 奇偶行变色
                    baseCollectionAction.changeColor();
                } else {
                    $("#smsListCon .no-data").show();
                }
            },
            /*手机号和手机串码失去焦点和双击切换*/
            initBlurDouble: function () {
                var _this = this;
                $(".sim-card-con").on('blur', 'input', function () { //
                    // 手机号和手机串码失去焦点操作基本一样
                    // 手机号需要校验必填项和正则
                    var $this = $(this);
                    var thisVal = $this.val();
                    var index = $this.parents('tr').attr('index') - 1;
                    if ($this.hasClass('phone-number-input')) { // 如果是手机号还要去掉必填标志
                        var phoneReg = /(^1[3|4|5|7|8]\d{9}$)|(^09\d{8}$)/;
                        if (!phoneReg.test(thisVal)) {
                            layer.msg('手机号未输入或者输入不正确', {
                                icon: 1,
                                time: 3000 //2秒关闭（如果不配置，默认是3秒）
                            });
                            return false;
                        } else {
                            _this.simArr[index].goodsSim.telephone = thisVal;
                        }
                    }
                    $this.parents('td').find('.star').hide();
                    $this.parents('td').find('.blur-input-con').show().html(thisVal);
                    $this.parent('.td-input-con').hide();
                }).on('dblclick', '.blur-input-con', function () { // 双击切换回编辑状态
                    var $this = $(this);
                    $this.hide().siblings('.td-input-con').show();
                }).on('blur', '.imei-number-input', function () { // 手机串码失去焦点
                    var $this = $(this);
                    var thisVal = $this.val();
                    var index = $this.parents('tr').attr('index') - 1;
                    _this.simArr[index].goodsSim.telephN = thisVal;
                });
            },
            /*sim卡的保存入库*/
            initSaveSimCard: function () {
                var _this = this;
                // 需求 必须把手机号校验通过才去发入库请求
                $("#saveSimCard").on('click', function () {
                    if (!personId) {
                        layer.msg('请先完成基本信息的采集，并且入库成功！', {
                            icon: 1,
                            time: 2000 //2秒关闭（如果不配置，默认是3秒）
                        });
                        return false;
                    }
                    var flag = true;
                    $("#simCardTbody tr").each(function (index, item) {
                        var $this = $(this);
                        var phoneReg = /(^1[3|4|5|7|8]\d{9}$)|(^09\d{8}$)/;
                        var phoneVal = $this.find('.phone-number-input').val();
                        if (!phoneReg.test(phoneVal)) {
                            layer.msg('请保证手机号输入，并且输入正确！', {
                                icon: 1,
                                time: 3000 //2秒关闭（如果不配置，默认是3秒）
                            });
                            flag = false;
                            return false;
                        }
                    });
                    if (flag) { // 采集的每张sim卡都符合要求才可以发送请求
                        var receivedData = _this.simArr;
                        $.ajax({
                            type: 'post',
                            url: "/htmisWeb/goodsCollect/addGoodsCollect.do",
                            dataType: 'json',
                            contentType: 'application/json',
                            cache: false,
                            data: JSON.stringify({
                                "receivedData": receivedData,
                                "personId": personId,
                                "startTime": new Date().getTime(),
                                "goodsBtyCode": 1 // sim卡BtyCode是1
                            }),
                            success: function (data) {
                                var result = data.result;
                                if (result == true) {
                                    collectionObj['collSimFlag'] = 1;
                                    layer.msg('sim卡入库成功', {
                                        icon: 1,
                                        time: 2000 //2秒关闭（如果不配置，默认是3秒）
                                    });
                                } else {
                                    layer.msg('sim卡入库失败，请稍候再试', {
                                        icon: 1,
                                        time: 2000 //2秒关闭（如果不配置，默认是3秒）
                                    });
                                }
                            }
                        });
                    }
                });
            },
            /*渲染goodsSim（SIM卡ID,通讯录条数，短信息条数，）*/
            renderGoodsSim: function (goodsSim) {
                // alert(goodsSim.billsNum)
                var htmlArr = [];
                this.index = $("#simCardTbody tr").length;
                this.index++;
                htmlArr.push('\
				<tr index="', this.index, '" style="cursor:auto;">\
					<td>', this.index, '</td>\
					<td class="">\
						<div class="td-input-con">\
						<span class="star">*</span>\
						<input type="text" class="phone-number-input">\
						</div>\
						<div class="blur-input-con display-none"></div>\
					</td>\
					<td>\
						<div class="td-input-con">\
						<input type="text" class="imei-number-input">\
						</div>\
						<div class="blur-input-con display-none"></div>\
					</td>\
					<td>', goodsSim.iccid, '</td>\
					<td class="pointer-color mail-btn">', goodsSim.directoryNum, '</td>\
					<td class="pointer-color sms-btn">', goodsSim.smsNum, '</td>\
					<td><span class="delete-sim-item"><img src="../image/collection/delete-btn.png" alt=""></span></td>\
				</tr>');
                $("#simCardTbody").append(htmlArr.join(''));
                $(".sim-card-con .no-data").hide();
            },
            // 删除以后的刷新动作
            refreshGoodSim: function () {
                var _this = this;
                var htmlArr = [];
                $.each(this.simArr, function (index, item) {
                    htmlArr.push('\
				<tr index="', index + 1, '" style="cursor:auto;">\
					<td>', index + 1, '</td>\
					<td class="">\
						<div class="td-input-con">\
						<span class="star">*</span>\
						<input type="text" class="phone-number-input">\
						</div>\
						<div class="blur-input-con display-none"></div>\
					</td>\
					<td>\
						<div class="td-input-con">\
						<input type="text" id="imei-number-input">\
						</div>\
						<div class="blur-input-con display-none"></div>\
					</td>\
					<td>', item.goodsSim.iccid, '</td>\
					<td class="pointer-color mail-btn">', item.goodsSim.directoryNum, '</td>\
					<td class="pointer-color sms-btn">', item.goodsSim.smsNum, '</td>\
					<td><span class="delete-sim-item"><img src="../image/collection/delete-btn.png" alt=""></span></td>\
				</tr>');
                });
                $("#simCardTbody").html(htmlArr.join(''));
            }
        };
        simObj.init();
        /*用户账号信息设置相关*/
        var accountSetting = {
            init: function () {
                this.initQuery();
                this.initSaveAccount();
                this.initResetAccount();
                this.initClickAccount();
            },
            /*查询用户账号，警员号，用户单位，当前状态并返回*/
            initQuery: function () {
                var _this = this;
            },
            /*点击保存按钮去操作*/
            initSaveAccount: function () {
                var _this = this;
                $(document.body).on('click', '.account-btn .save-btn', function () {

                });
            },
            /*点击重置按钮的操作*/
            initResetAccount: function () {
                var _this = this;
                $(document.body).on('click', '.account-btn .reset-btn', function () {

                });
            },
            /*点击用户设置按钮*/
            initClickAccount: function () {
                var _this = this;
                $(".test-btn").on('click', function () {
                    var obj = $(".account-wrapper").html();
                    layer.open({
                        type: 1,
                        title: false, //显示标题
                        area: ['500', '520px'],
                        content: obj,//捕获的元素，注意：最好该指定的元素要存放在body最外层，否则可能被其它的相对元素所影响
                        resize: false,
                        // btn: ['确定', '取消'],
                        yes: function (index, layero) {
                            layer.close(index);
                        },
                        btn2: function (index, layero) {
                            layer.close(index);
                        },
                        cancel: function (index, layero) {
                            layer.close(index);
                        }
                    });
                });
            }
        };
        accountSetting.init();


    })();











</script>
<script>
    var xx = {
        "hw": {
            "order": _this.getOrder('hw'),
            "collectFlag": $("#hw-flag").xMethod('getValue')(),
            "requiredFlag": scopedBingbang['hw-require']
        },
        "foot": {
            "order": _this.getOrder('foot'),
            "threshold": Number($(".foot-count").html()),
            "collectFlag": $("#foot-flag").xMethod('getValue')(),
            "requiredFlag": scopedBingbang['foot-require']
        },
        "iris": {
            "order": _this.getOrder('iris'),
            "threshold": Number($(".iris-count").html()),
            "collectFlag": $("#iris-flag").xMethod('getValue')(),
            "requiredFlag": scopedBingbang['iris-require']
        },
        "phone": {
            "order": _this.getOrder('phone'),
            "collectFlag": $("#phone-flag").xMethod('getValue')(),
            "requiredFlag": scopedBingbang['phone-require']
        },
        "photo": {
            "left": {
                "autoCut": scopedBingbang['left-autoCut'],// 是否自动切割
                "algorithm": $("#leftPhotoSf").xMethod('getItems')(), // 质量判断算法
                "threshold": Number($(".photo .ver-count").html()),  // 阀值
                "faceRecognition": scopedBingbang['left-faceRecognition'], // 是否判断人脸
                "printBreastplate": scopedBingbang['left-printBreastplate'] // 是否打印胸牌
            },
            "front": {
                "autoCut": scopedBingbang['ver-autoCut'],// 是否自动切割
                "algorithm": $("#verPhotoSf").xMethod('getItems')(), // 质量判断算法
                "threshold": Number($(".photo .left-count").html()),  // 阀值
                "faceRecognition": scopedBingbang['ver-faceRecognition'], // 是否判断人脸
                "printBreastplate": scopedBingbang['ver-printBreastplate'] // 是否打印胸牌
            },
            "order": _this.getOrder('photo'),
            "right": {
                "autoCut": scopedBingbang['right-autoCut'],// 是否自动切割
                "algorithm": $("#rightPhotoSf").xMethod('getItems')(), // 质量判断算法
                "threshold": Number($(".photo .right-count").html()),  // 阀值
                "faceRecognition": scopedBingbang['right-faceRecognition'], // 是否判断人脸
                "printBreastplate": scopedBingbang['right-printBreastplate'] // 是否打印胸牌
            },
            "collectFlag": $("#photo-flag").xMethod('getValue')(), // 是否采集
            "requiredFlag": scopedBingbang['photo-require'], // 是否必采
            "auditFlag": scopedBingbang['photo-audit'] // 是否审核
        },
        "voice": {
            "order": _this.getOrder('voice'),
            "auditFlag": scopedBingbang['voice-audit'],
            "threshold": '',
            "collectFlag": $("#voice-flag").xMethod('getValue')(),
            "requiredFlag": scopedBingbang['voice-require']
        },
        "finger": {
            "flat": {
                "quality": {
                    "info": $("#flatIf").xMethod('getItems')(),
                    "algorithm": $("#flatSf").xMethod('getItems')(),
                    "threshold": {
                        "H": Number($(".flat .H-count").html()),
                        "M": Number($(".flat .M-count").html()),
                        "S": Number($(".flat .S-count").html()),
                        "X": Number($(".flat .X-count").html()),
                        "Z": Number($(".flat .Z-count").html())
                    },
                    "collectType": $("#flatFs").xMethod('getItems')()
                },
                "auditFlag": scopedBingbang['flat-audit'],
                "collectFlag": $("#flat-flag").xMethod('getValue')(),
                "requiredFlag": scopedBingbang['flat-require']
            },
            "palm": {
                "quality": {
                    "algorithm": $("#palmSf").xMethod('getItems')(),
                    "threshold": {
                        "C": Number($(".palm .C-count").html()),
                        "Z": Number($(".palm .Z-count").html())
                    }
                },
                "auditFlag": scopedBingbang['palm-audit'],
                "collectFlag": $("#palm-flag").xMethod('getValue')(),
                "requiredFlag": scopedBingbang['palm-require']
            },
            "roll": {
                "quality": {
                    "info": $("#rollIf").xMethod('getItems')(),
                    "algorithm": $("#rollSf").xMethod('getItems')(),
                    "threshold": {
                        "H": Number($(".roll .H-count").html()),
                        "M": Number($(".roll .M-count").html()),
                        "S": Number($(".roll .S-count").html()),
                        "X": Number($(".roll .X-count").html()),
                        "Z": Number($(".roll .Z-count").html())
                    }
                },
                "auditFlag": scopedBingbang['roll-audit'],
                "collectFlag": $("#roll-flag").xMethod('getValue')(),
                "requiredFlag": scopedBingbang['roll-require']
            },
            "order": _this.getOrder('finger')
        },
        "marker": {
            "order": _this.getOrder('marker'),
            "collectFlag": $("#marker-flag").xMethod('getValue')(),
            "requiredFlag": {
                "tbbj": scopedBingbang['tbbj-require'],
                "tmtz": scopedBingbang['tmtz-require']
            }
        },
        "cfgName": scopedBingbang['cfgName'],
        "effects": {
            "order": _this.getOrder('effects'),
            "collectFlag": $("#effects-flag").xMethod('getValue')(),
            "requiredFlag": scopedBingbang['effect-require']
        },
        "orgCode": scopedBingbang['orgCode'],
        "bankCard": {
            "order": _this.getOrder('bankCard'),
            "collectFlag": $("#bankCard-flag").xMethod('getValue')(),
            "requiredFlag": scopedBingbang['bank-require']
        }
    }
</script>
<script>
    ['','', '', '', '', '', '', '', '', ''];
</script>
<script>
     mrTimePicker.timePicker(document.querySelector('#test'), {
            mode: 'date', //面板状态参数
            format: 'YYYY-MM-DD hh:mm:ss', //格式化
            autoComplete: false,//自动完成
            disabledDate: { //禁用日期
                disabledDate: ['2019-01-01', '2019-02-02'],
                disabledHours: [18, 23],
                disabledMinutes: [0, 31],
                disabledSeconds: [55, 56]
            },
            allowClear: false,
            showTime: true,
            onChange: function () {
                debugger
            },
            onOk: function () {
                debugger
            },
            onPanelChange: function () {
                debugger
            },
            onOpenChange: function () {
                debugger
            }
        })

    /* mrTimePicker.timePicker(document.querySelector('#test1'), {
        mode: 'date', //面板状态参数
        format: 'YYYY-MM-DD', //格式化
        autoComplete: false,//自动完成
        disabledDate: { //禁用日期
            disabledDate: ['2019-01-01', '2019-02-02'],
            disabledHours: [18, 23],
            disabledMinutes: [0, 31],
            disabledSeconds: [55, 56]
        }
    }) */
</script>
</html>